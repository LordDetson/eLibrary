<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<ui:composition>
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">
                <h:outputText id="current-search" value="#{bookListController.currentSearch}"/>
            </h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group mr-2">
                    <a class="btn btn-sm btn-outline-secondary">Share</a>
                    <a class="btn btn-sm btn-outline-secondary">Export</a>
                </div>
                <a class="btn btn-sm btn-outline-secondary dropdown-toggle">
                    This week
                </a>
            </div>
        </div>
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h:form id="search-symbol">
                <nav class="nav nav-pills justify-content-center">
                    <ui:repeat value="#{symbolsController.getCharsRu()}" var="char">
                        <h:commandLink value="#{char}"
                                       styleClass="nav-link #{bookListController.currentSearch == char ? 'active':''}">
                            <f:param name="search_symbol" value="#{char}"/>
                            <f:ajax event="click"
                                    render="@form :current-search :sidebar :books-count :pagination1 :books-table :pagination2"
                                    listener="#{bookListController.fillBooksByFirstSymbol()}" onevent="showProgress"/>
                        </h:commandLink>
                    </ui:repeat>
                </nav>
            </h:form>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col">
                    <p><strong><h:outputText id="books-count" value="#{mainContent['book.count']}: #{bookListController.getTotalBooksCount()}"/></strong></p>
                </div>
                <div class="col">
                    <h:form id="pagination1" style="width: 100%">
                        <nav aria-label="Page navigation by books">
                            <ul class="pagination justify-content-end">
                                <li class="page-item #{bookListController.selectedPageNumber - 1 == 0 ? 'disabled' : ''}">
                                    <h:commandLink styleClass="page-link"
                                                   value="#{mainContent['pagination.previous']}">
                                        <f:param name="page_number" value="#{bookListController.selectedPageNumber - 1}"/>
                                        <f:ajax event="click"
                                                render="@form :current-search :search-symbol :books-count :sidebar :books-table :pagination2"
                                                listener="#{bookListController.selectPage()}" onevent="showProgress"/>
                                    </h:commandLink>
                                </li>
                                <ui:repeat value="#{bookListController.pageNumbers}" var="pageNumber">
                                    <li class="page-item #{pageNumber == bookListController.selectedPageNumber ? 'active' : ''}">
                                        <h:commandLink value="#{pageNumber}" styleClass="page-link">
                                            <f:param name="page_number" value="#{pageNumber}"/>
                                            <f:ajax event="click"
                                                    render="@form :current-search :search-symbol :books-count :sidebar :books-table :pagination2"
                                                    listener="#{bookListController.selectPage()}" onevent="showProgress"/>
                                        </h:commandLink>
                                    </li>
                                </ui:repeat>
                                <li class="page-item #{bookListController.selectedPageNumber + 1 > bookListController.pageNumbers.size() ? 'disabled' : ''}">
                                    <h:commandLink styleClass="page-link"
                                                   value="#{mainContent['pagination.next']}">
                                        <f:param name="page_number" value="#{bookListController.selectedPageNumber + 1}"/>
                                        <f:ajax event="click"
                                                render="@form :current-search :search-symbol :books-count :sidebar :books-table :pagination2"
                                                listener="#{bookListController.selectPage()}" onevent="showProgress"/>
                                    </h:commandLink>
                                </li>
                            </ul>
                        </nav>
                    </h:form>
                </div>
            </div>
            <div class="row">
                <div id="loader-wrapper" class="d-flex justify-content-center">
                    <div class="spinner-border" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>
                <div id="books-table-wrapper" class="table-responsive-xl">
                    <h:dataTable id="books-table" value="#{bookListController.currentBooksOnPage.entrySet().toArray()}" var="entryBook"
                                 cellspacing="10px"
                                 styleClass="table table-hover" columnClasses="col1, col2, col3">
                        <h:column>
                            <h:graphicImage value="/bookContext?id=#{entryBook.key}&amp;action=show_image" width="280px"/>
                        </h:column>
                        <h:column>
                            <p>
                                <h:outputLink value="#{request.contextPath}/bookContext" target="_blank" styleClass="h5">
                                    <h:outputText value="${entryBook.value.name}"/>
                                    <f:param name="id" value="#{entryBook.key}"/>
                                    <f:param name="action" value="read_pdf"/>
                                </h:outputLink>
                            </p>
                            <p>
                                <strong>#{mainContent['book.pageCount']}:</strong> #{entryBook.value.pageCount}<br/>
                                <strong>#{mainContent['book.genre']}:</strong> #{entryBook.value.genre}<br/>
                                <strong>#{mainContent['book.author']}:</strong> #{entryBook.value.author}<br/>
                                <strong>#{mainContent['book.publisher']}:</strong> #{entryBook.value.publisher}<br/>
                                <strong>#{mainContent['book.publishYear']}:</strong> #{entryBook.value.publishDate}<br/>
                                <strong>#{mainContent['book.isbn']}:</strong> #{entryBook.value.isbn}<br/>
                                <h:outputLink value="#{request.contextPath}/bookContext" target="_blank">
                                    <ui:include src="downloadPdfSvg.xhtml"/>
                                    <f:param name="id" value="#{entryBook.key}"/>
                                    <f:param name="action" value="save_pdf"/>
                                </h:outputLink>
                            </p>
                        </h:column>
                        <h:column>
                            <p><strong>#{mainContent['book.description']}</strong></p>
                            <p>#{entryBook.value.description}</p>
                        </h:column>
                    </h:dataTable>
                </div>
            </div>
            <div class="row">
                <h:form id="pagination2" style="width: 100%">
                    <nav aria-label="Page navigation by books">
                        <ul class="pagination justify-content-center">
                            <li class="page-item #{bookListController.selectedPageNumber - 1 == 0 ? 'disabled' : ''}">
                                <h:commandLink styleClass="page-link"
                                               value="#{mainContent['pagination.previous']}">
                                    <f:param name="page_number" value="#{bookListController.selectedPageNumber - 1}"/>
                                    <f:ajax event="click"
                                            render="@form :current-search :search-symbol :books-count :pagination1 :books-table :sidebar"
                                            listener="#{bookListController.selectPage()}" onevent="showProgress"/>
                                </h:commandLink>
                            </li>
                            <ui:repeat value="#{bookListController.pageNumbers}" var="pageNumber">
                                <li class="page-item #{pageNumber == bookListController.selectedPageNumber ? 'active' : ''}">
                                    <h:commandLink value="#{pageNumber}" styleClass="page-link">
                                        <f:param name="page_number" value="#{pageNumber}"/>
                                        <f:ajax event="click"
                                                render="@form :current-search :search-symbol :books-count :pagination1 :books-table :sidebar"
                                                listener="#{bookListController.selectPage()}" onevent="showProgress"/>
                                    </h:commandLink>
                                </li>
                            </ui:repeat>
                            <li class="page-item #{bookListController.selectedPageNumber + 1 > bookListController.pageNumbers.size() ? 'disabled' : ''}">
                                <h:commandLink styleClass="page-link"
                                               value="#{mainContent['pagination.next']}">
                                    <f:param name="page_number" value="#{bookListController.selectedPageNumber + 1}"/>
                                    <f:ajax event="click"
                                            render="@form :current-search :search-symbol :books-count :pagination1 :books-table :sidebar"
                                            listener="#{bookListController.selectPage()}" onevent="showProgress"/>
                                </h:commandLink>
                            </li>
                        </ul>
                    </nav>
                </h:form>
            </div>
        </div>
    </main>
</ui:composition>
</html>
